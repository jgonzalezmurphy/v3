<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>VAULT</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg:#e6faff;--text:#000;--header:#000;--card-border:rgba(0,0,0,.3);--glass:rgba(15,23,42,.98);--notes-btn:#38bdf8;--subtext:#475569}
        body.dark-mode{--bg:#020617;--text:#cbd5e1;--header:#fff;--card-border:rgba(255,255,255,.1);--glass:rgba(0,0,0,.95);--notes-btn:#38bdf8;--subtext:#94a3b8}
        body{background-color:var(--bg)!important;color:var(--text);font-family:'Inter',sans-serif;min-height:100vh;padding:1rem}
        .max-w-3xl{max-width:48rem;margin:0 auto}.flex{display:flex}.grid{display:grid}.grid-cols-3{grid-template-columns:repeat(3,1fr)}
        .gap-2{gap:.5rem}.mb-6{margin-bottom:1.5rem}.mt-6{margin-top:1.5rem}.mt-2{margin-top:.5rem}
        .rounded-xl{border-radius:.75rem}.rounded-3xl{border-radius:1.5rem}.rounded-full{border-radius:9999px}.shadow-2xl{box-shadow:0 25px 50px -12px rgba(0,0,0,.25)}
        .vault-logo{font-size:2.5rem;font-weight:1000;color:var(--header);font-style:italic;letter-spacing:-.07em;text-transform:uppercase;cursor:pointer}
        .adaptive-bg { background-color: var(--bg); transition: background-color 0.3s; border-radius: 12px; padding: 10px; border:1px solid var(--card-border); color: var(--header); font-weight:900; font-size:10px}
        .thin-search{background:0 0;border:none;border-bottom:3px solid var(--header);width:100%;font-size:14px;padding:10px 0;outline:0;color:var(--header);font-weight:950;margin-bottom:1.5rem}
        .glass{background:var(--glass);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.1);padding:1.25rem;position:relative}
        .media-card{position:relative;border:1px solid var(--card-border);border-radius:12px;padding:1rem;margin-bottom:.75rem;color:white;overflow:hidden}
        .priority-bg-1{background:linear-gradient(135deg,#b91c1c,#0f172a)}.priority-bg-2{background:linear-gradient(135deg,#b45309,#0f172a)}.priority-bg-3{background:linear-gradient(135deg,#1d4ed8,#0f172a)}.priority-bg-4{background:#0f172a}
        #live-results{position:absolute;top:100%;left:0;right:0;background:#0f172a;border:1px solid rgba(255,255,255,0.2);z-index:1000;display:none;max-height:300px;overflow-y:auto;border-radius:0 0 12px 12px}
        #live-results.active{display:block}.live-item{padding:12px;border-bottom:1px solid rgba(255,255,255,0.05);cursor:pointer;display:flex;align-items:center;gap:12px;color:white}
        .live-img{width:40px;height:55px;object-fit:cover;background:#334155;border-radius:4px}
        .notes-trigger{font-size:10px;font-weight:1000;color:var(--notes-btn);letter-spacing:.05em;cursor:pointer;text-transform:uppercase;text-decoration:underline}
        .notes-area{background:rgba(0,0,0,0.85);border:1px solid rgba(255,255,255,0.4);color:#fff;font-size:12px;width:100%;border-radius:6px;outline:0;resize:none;overflow:hidden;height:0;opacity:0;transition:all 0.2s}
        .notes-area.active{height:auto;min-height:45px;padding:10px;margin-top:10px;opacity:1}
        .card-btn-dark{text-[9px] uppercase px-2 py-1 rounded bg-black/60 text-white border border-white/10 outline-none; font-size: 9px; font-weight: 800}
        #settings-menu{position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:2000;display:none;align-items:center;justify-content:center}
        #settings-menu.active{display:flex}
    </style>
</head>
<body>
    <div class="max-w-3xl">
        <header class="flex justify-between items-center mb-6">
            <h1 class="vault-logo" onclick="toggleTheme()">VAULT</h1>
            <button onclick="document.getElementById('settings-menu').classList.toggle('active')" class="adaptive-bg">SETTINGS</button>
        </header>

        <input id="global-search" type="text" class="thin-search" placeholder="FILTER VAULT..." oninput="render()">

        <div class="glass rounded-3xl shadow-2xl">
            <div class="relative">
                <input id="title" type="text" placeholder="Entry title..." oninput="debounceSearch()" style="width:100%;padding:1.2rem;background:rgba(0,0,0,0.6);color:white;border-radius:12px;border:1px solid rgba(255,255,255,0.2);outline:none;font-weight:700">
                <div id="live-results"></div>
            </div>
            <div class="grid grid-cols-3 gap-2 mt-4">
                <select id="category" class="adaptive-bg"><option value="vidya">ðŸŽ® GAME</option><option value="movie">ðŸŽ¥ MOVIE</option><option value="tv">ðŸ“º TV</option></select>
                <select id="priority" class="adaptive-bg"><option value="1">IMM</option><option value="2">HI</option><option value="3" selected>MED</option><option value="4">LOW</option></select>
                <button onclick="finalizeAdd(document.getElementById('title').value,'2026',0,'Manual','--')" style="background:#2563eb;color:white;font-weight:950;border-radius:12px;border:none;font-size:10px">ADD ENTRY</button>
            </div>
        </div>

        <div id="tables-container"></div>
    </div>

    <div id="settings-menu">
        <div style="background:#0f172a;padding:2rem;border-radius:24px;width:90%;max-width:400px;border:1px solid rgba(255,255,255,0.1)">
            <button onclick="downloadBackup()" style="width:100%;padding:1rem;margin-bottom:1rem;background:#334155;color:white;border:none;border-radius:12px;font-weight:900">EXPORT DATA</button>
            <button onclick="document.getElementById('settings-menu').classList.remove('active')" style="width:100%;padding:1rem;background:white;color:black;border:none;border-radius:12px;font-weight:900">CLOSE</button>
        </div>
    </div>

    <script>
        const TMDB_KEY = "f8baa5b950fb92e47e7250e9faaa2a5c";
        const RAWG_KEY = "40dcecf909e541df8eafbb648d749512";
        
        let items=JSON.parse(localStorage.getItem('media_v1'))||[],searchTimeout,deleteTimers={};

        function toggleTheme(){document.body.classList.toggle('dark-mode');localStorage.setItem('vault_dark',document.body.classList.contains('dark-mode'))}
        if(localStorage.getItem('vault_dark')==='true')document.body.classList.add('dark-mode');

        function debounceSearch(){clearTimeout(searchTimeout);searchTimeout=setTimeout(performLiveSearch,400)}

        async function performLiveSearch(){
            const title=document.getElementById('title').value.trim(),cat=document.getElementById('category').value,dropdown=document.getElementById('live-results');
            if(title.length<2){dropdown.classList.remove('active');return}
            dropdown.innerHTML='<div class="p-3 text-white text-xs">Searching...</div>';dropdown.classList.add('active');
            try {
                let results=[];
                if(cat==='vidya'){
                    const r=await fetch(`https://api.rawg.io/api/games?key=${RAWG_KEY}&search=${encodeURIComponent(title)}&page_size=5`);
                    const d=await r.json();
                    results=d.results.map(g=>({title:g.name,year:(g.released||'').split('-')[0],id:g.id,img:g.background_image,score:g.metacritic||0,genre:g.genres?.[0]?.name||'Game'}));
                } else {
                    const r=await fetch(`https://api.themoviedb.org/3/search/${cat}?api_key=${TMDB_KEY}&query=${encodeURIComponent(title)}`);
                    const d=await r.json();
                    results=d.results.map(m=>({title:m.title||m.name,year:(m.release_date||m.first_air_date||'').split('-')[0],id:m.id,img:m.poster_path?`https://image.tmdb.org/t/p/w92${m.poster_path}`:''}));
                }
                dropdown.innerHTML='';
                results.forEach(res=>{
                    const el=document.createElement('div');el.className='live-item';
                    el.innerHTML=`<img src="${res.img}" class="live-img"><div><b>${res.title}</b><br><small>${res.year}</small></div>`;
                    el.onclick=()=>processSelection(cat,res);
                    dropdown.appendChild(el);
                });
            } catch(e){dropdown.innerHTML='<div class="p-3 text-red-400">Error: Check API Key</div>'}
        }

        async function processSelection(cat,res){
            document.getElementById('live-results').classList.remove('active');
            let score=res.score||0,year=res.year,genre=res.genre||'Media',runtime='--';
            if(cat!=='vidya'){
                const det=await(await fetch(`https://api.themoviedb.org/3/${cat}/${res.id}?api_key=${TMDB_KEY}`)).json();
                score=Math.round(det.vote_average*10);genre=det.genres?.[0]?.name||cat;
                runtime=cat==='movie'?det.runtime+'m':det.number_of_seasons+'S';
            }
            finalizeAdd(res.title,year,score,genre,runtime);
        }

        function finalizeAdd(title,year,score,genre,runtime){
            items.push({id:Date.now(),title,category:document.getElementById('category').value,priority:parseInt(document.getElementById('priority').value),status:'to-do',score,genre,release:year,runtime,notes:''});
            document.getElementById('title').value='';save();
        }

        function save(){localStorage.setItem('media_v1',JSON.stringify(items));render()}

        function requestDelete(id, btn) {
            if(btn.innerText === 'DEL') {
                btn.innerText = 'SURE?'; btn.style.background = '#dc2626';
                deleteTimers[id] = setTimeout(() => { btn.innerText = 'DEL'; btn.style.background = ''; }, 2000);
            } else {
                clearTimeout(deleteTimers[id]); items = items.filter(z => z.id !== id); save();
            }
        }

        function render(){
            const container=document.getElementById('tables-container'),filter=document.getElementById('global-search').value.toLowerCase();
            container.innerHTML='';
            ['vidya','movie','tv'].forEach(cat=>{
                let list=items.filter(i=>i.category===cat && i.title.toLowerCase().includes(filter));
                if(list.length===0) return;
                let section=`<h2 class="mt-6">${cat.toUpperCase()}</h2>`;
                list.forEach(i=>{
                    const pMap={1:'IMM',2:'HI',3:'MED',4:'LOW'};
                    section+=`<div class="media-card priority-bg-${i.priority}">
                        <div class="flex justify-between items-start">
                            <div><b style="font-size:14px; text-transform:uppercase">${i.title}</b><br><small style="opacity:0.8">${i.genre} | ${i.release} | ${i.runtime}</small></div>
                            <div class="flex items-center gap-3">
                                <button onclick="window.open('https://www.youtube.com/results?search_query=${encodeURIComponent(i.title+' official trailer')}','_blank')" style="background:rgba(255,255,255,0.2); width:32px; height:32px; border-radius:99px; border:1px solid rgba(255,255,255,0.4); color:white; font-weight:bold; cursor:pointer">â–¶</button>
                                <span style="font-size:1.5rem;font-weight:900">${i.score}</span>
                            </div>
                        </div>
                        <div class="mt-2 flex items-center gap-2">
                            <select onchange="items.find(x=>x.id===${i.id}).priority=parseInt(this.value);save()" class="card-btn-dark">${Object.entries(pMap).map(([v,t])=>`<option value="${v}" ${i.priority==v?'selected':''}>${t}</option>`).join('')}</select>
                            <span class="notes-trigger" onclick="document.getElementById('note-${i.id}').classList.toggle('active')">Notes +</span>
                            <select onchange="items.find(x=>x.id===${i.id}).status=this.value;save()" class="card-btn-dark" style="flex:1"><option value="to-do" ${i.status==='to-do'?'selected':''}>To-Do</option><option value="done" ${i.status==='done'?'selected':''}>Done</option></select>
                            <button onclick="requestDelete(${i.id}, this)" class="card-btn-dark">DEL</button>
                        </div>
                        <textarea id="note-${i.id}" class="notes-area ${i.notes?'active':''}" onblur="items.find(x=>x.id===${i.id}).notes=this.value;save()" placeholder="Notes...">${i.notes}</textarea>
                    </div>`;
                });
                container.innerHTML+=section;
            });
        }
        function downloadBackup(){const a=document.createElement('a');a.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(items));a.download="vault.json";a.click()}
        render();
    </script>
</body>
</html>
