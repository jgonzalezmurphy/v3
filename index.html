<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json"><link rel="icon" type="image/png" href="icon.png"><link rel="apple-touch-icon" href="icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --bg: #e6faff; }
        body { background-color: var(--bg) !important; color: #1e293b; font-family: 'Inter', sans-serif; margin: 0; padding: 1rem; min-height: 100vh; }
        h2 { color: #000000 !important; font-weight: 950 !important; text-transform: uppercase; letter-spacing: 0.12em; font-size: 1.1rem !important; margin-top: 1.5rem; margin-bottom: 0.75rem; display: block; }
        .media-card { position: relative; border: 1px solid rgba(255, 255, 255, 0.4); backdrop-filter: blur(20px); border-radius: 12px; overflow: hidden; margin-bottom: 0.75rem; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .priority-bg-1 { background: linear-gradient(135deg, rgba(153, 27, 27, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%); }
        .priority-bg-2 { background: linear-gradient(135deg, rgba(146, 64, 14, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%); }
        .priority-bg-3 { background: linear-gradient(135deg, rgba(30, 58, 138, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%); }
        .priority-bg-4 { background: rgba(15, 23, 42, 0.9); }
        .card-vidya { border-left: 5px solid #fbbf24; } .card-movie { border-left: 5px solid #ef4444; } .card-tv { border-left: 5px solid #10b981; }
        .category-watermark { position: absolute; top: -5px; right: 40px; font-size: 1.8rem; font-weight: 950; opacity: 0.05; pointer-events: none; font-style: italic; text-transform: uppercase; z-index: 0; color: white; }
        .glass { background: rgba(15, 23, 42, 0.88); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.2); }
        #status-log { font-family: monospace; font-size: 10px; color: #ffffff !important; text-align: center; margin-top: 8px; font-weight: bold; text-transform: uppercase; }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.1); } }
        .syncing #vault-logo { animation: pulse 1s infinite; }
        .notes-trigger { font-size: 8px; font-weight: 900; color: #38bdf8; letter-spacing: 0.1em; cursor: pointer; text-transform: uppercase; }
        .notes-area { background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); color: #ffffff; font-size: 11px; width: 100%; border-radius: 6px; outline: none; resize: none; overflow: hidden; height: 0; opacity: 0; transition: all 0.2s; margin: 0; }
        .notes-area.active { height: auto; min-height: 40px; padding: 8px; margin-top: 8px; opacity: 1; }
        .btn-confirm { background-color: #ef4444 !important; }
        .trailer-btn { background: rgba(255,255,255,0.15); width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; border-radius: 50%; color: white; font-size: 9px; transition: all 0.2s; }
    </style>
</head>
<body>
    <div class="max-w-3xl mx-auto pb-32" id="app-root">
        <header class="mb-6 flex justify-between items-center">
            <div><h1 id="vault-logo" class="text-4xl font-[1000] text-black italic tracking-[-0.07em] uppercase leading-none">VAULT</h1><p class="text-black text-[10px] uppercase font-black mt-1 tracking-[0.25em]">Archive 2026</p></div>
            <div class="grid grid-cols-2 gap-1">
                <button onclick="toggleCompleted()" class="text-white bg-black text-[8px] uppercase font-black px-2 py-1.5 rounded-lg shadow-md">History</button>
                <button onclick="setupCloud()" class="text-white bg-black text-[8px] uppercase font-black px-2 py-1.5 rounded-lg shadow-md">Cloud</button>
                <button onclick="downloadBackup()" class="text-white bg-black text-[8px] uppercase font-black px-2 py-1.5 rounded-lg shadow-md">EXP</button>
                <button onclick="document.getElementById('importFile').click()" class="text-white bg-black text-[8px] uppercase font-black px-2 py-1.5 rounded-lg shadow-md">IMP</button>
                <input type="file" id="importFile" class="hidden" accept=".json" onchange="importBackup(this)">
            </div>
        </header>

        <div class="glass p-5 rounded-3xl mb-12">
            <div class="grid grid-cols-1 gap-4">
                <input id="title" type="text" placeholder="Entry Title..." class="bg-black/40 border border-white/10 p-4 rounded-xl text-white w-full outline-none placeholder-white/50">
                <div class="grid grid-cols-3 gap-2">
                    <select id="category" class="bg-slate-800 p-3 rounded-xl text-[10px] text-white font-black uppercase outline-none">
                        <option value="movie">ðŸŽ¥ Movie</option><option value="tv">ðŸ“º TV Show</option><option value="vidya" selected>ðŸŽ® Game</option>
                    </select>
                    <select id="priority" class="bg-slate-800 p-3 rounded-xl text-[10px] text-white font-black uppercase outline-none">
                        <option value="1">Immediate</option><option value="2">High</option><option value="3" selected>Medium</option><option value="4">Low</option>
                    </select>
                    <select id="sort-order" onchange="localStorage.setItem('vault_sort', this.value); render();" class="bg-blue-900 p-3 rounded-xl text-[10px] text-white font-black uppercase outline-none">
                        <option value="priority">Sort: Pri</option><option value="recent">Sort: New</option><option value="rating">Sort: Sc</option><option value="release">Sort: Yr</option><option value="genre">Sort: Gen</option>
                    </select>
                </div>
                <button onclick="addItem()" class="bg-blue-700 text-white py-4 rounded-xl font-black text-xs uppercase shadow-md active:scale-95 transition-transform">Add Entry</button>
                <div id="status-log">System Ready</div>
            </div>
        </div>
        <div id="tables-container" class="space-y-6"></div>
    </div>

    <script>
        const TMDB_KEY = "f8baa5b950fb92e47e7250e9faaa2a5c", CLIENT_ID = "8bjq7bqv85pvclvbdlo4ocgff060tp", CLIENT_SECRET = "rxwdetly09vb5pq41mx5ola1k1w2rm";
        let items = JSON.parse(localStorage.getItem('media_v1')) || [], collapsed = JSON.parse(localStorage.getItem('vault_collapsed')) || {}, cloudConfig = JSON.parse(localStorage.getItem('vault_cloud')) || { token: '', gistId: '' }, showAll = false;
        const savedSort = localStorage.getItem('vault_sort') || 'priority';
        document.getElementById('sort-order').value = savedSort;
        function logStatus(m) { document.getElementById('status-log').innerText = m; }
        async function save() { localStorage.setItem('media_v1', JSON.stringify(items)); localStorage.setItem('vault_collapsed', JSON.stringify(collapsed)); render(); if (cloudConfig.token && cloudConfig.gistId) { try { await fetch(`https://api.github.com/gists/${cloudConfig.gistId}`, { method: "PATCH", headers: { "Authorization": `token ${cloudConfig.token}` }, body: JSON.stringify({ files: { "vault.json": { content: JSON.stringify(items) } } }) }); logStatus("Cloud Saved"); } catch(e) { logStatus("Sync Failed"); } } }
        async function pullFromCloud() { if (!cloudConfig.token || !cloudConfig.gistId) return; logStatus("Connecting..."); try { const res = await fetch(`https://api.github.com/gists/${cloudConfig.gistId}`, { headers: { "Authorization": `token ${cloudConfig.token}` } }); const data = await res.json(); if (data.files?.["vault.json"]) { items = JSON.parse(data.files["vault.json"].content); render(); logStatus("Cloud Restored"); } } catch(e) { logStatus("Sync Error"); } }
        function downloadBackup() { const a = document.createElement('a'); a.href = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(items, null, 2)); a.download = "vault_backup.json"; a.click(); logStatus("Exported"); }
        function importBackup(i) { const r = new FileReader(); r.onload = e => { try { items = JSON.parse(e.target.result); save(); logStatus("Imported"); } catch(err) { logStatus("Invalid File"); } }; r.readAsText(i.files[0]); }
        async function refreshIGDBToken() { logStatus("Refreshing IGDB..."); try { const res = await fetch(`https://corsproxy.io/?${encodeURIComponent('https://id.twitch.tv/oauth2/token')}`, { method: 'POST', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body: `client_id=${CLIENT_ID}&client_secret=${CLIENT_SECRET}&grant_type=client_credentials` }); const d = await res.json(); if (d.access_token) { localStorage.setItem('igdb_token', d.access_token); return d.access_token; } } catch(e) { return null; } }
        async function hltbSearchAggressive(t) { const clean = t.replace(/[^a-zA-Z0-9\s]/g, '').trim(), words = clean.split(/\s+/); for (let i = words.length; i > 0; i--) { const q = words.slice(0, i).join(" "); try { const res = await fetch(`https://corsproxy.io/?${encodeURIComponent('https://howlongtobeat.com/api/search')}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ searchType: "games", searchTerms: q.split(" "), searchPage: 1, size: 5, use_fuzzy: true }) }); const d = await res.json(); if (d.data?.[0]?.comp_main > 0) return Math.round(d.data[0].comp_main / 3600) + 'h'; } catch(e) {} } return '--'; }
        async function fetchMetadata(item) { document.getElementById('app-root').classList.add('syncing'); try { if (item.category === 'vidya') { let token = localStorage.getItem('igdb_token') || await refreshIGDBToken(); const r = await fetch(`https://corsproxy.io/?${encodeURIComponent('https://api.igdb.com/v4/games')}`, { method: 'POST', headers: { 'Client-ID': CLIENT_ID, 'Authorization': `Bearer ${token}` }, body: `fields name, total_rating, first_release_date, genres.name; search "${item.title}"; limit 1;` }); if (r.status === 401) { token = await refreshIGDBToken(); return fetchMetadata(item); } const d = await r.json(); if (d?.[0]) { item.title = d[0].name; item.score = d[0].total_rating ? Math.round(d[0].total_rating) : 0; item.release = d[0].first_release_date ? new Date(d[0].first_release_date * 1000).getFullYear() : "2026"; item.genre = d[0].genres?.[0]?.name || "Game"; item.runtime = await hltbSearchAggressive(item.title); } } else { const r = await fetch(`https://api.themoviedb.org/3/search/${item.category}?api_key=${TMDB_KEY}&query=${encodeURIComponent(item.title)}`); const d = await r.json(); if (d.results?.[0]) { const m = d.results[0], det = await (await fetch(`https://api.themoviedb.org/3/${item.category}/${m.id}?api_key=${TMDB_KEY}`)).json(); item.title = m.title || m.name; item.score = Math.round(m.vote_average * 10); item.release = (m.release_date || m.first_air_date || "").split('-')[0]; item.runtime = item.category === 'movie' ? (det.runtime ? det.runtime + 'm' : '--') : (det.episode_run_time?.[0] ? det.episode_run_time[0] + 'm' : '--'); item.genre = det.genres?.[0]?.name || item.category.toUpperCase(); } } } catch (e) { logStatus("Metadata Error"); } document.getElementById('app-root').classList.remove('syncing'); save(); }
        function addItem() { const t = document.getElementById('title').value.trim(); if (!t) return; const newItem = { id: Date.now(), title: t, category: document.getElementById('category').value, priority: parseInt(document.getElementById('priority').value), status: 'to-do', score: 0, genre: 'Pending', release: '2026', runtime: '--', notes: '' }; items.push(newItem); document.getElementById('title').value = ''; render(); fetchMetadata(newItem); }
        function toggleCompleted() { showAll = !showAll; render(); }
        async function setupCloud() { const gt = prompt("GitHub Token:", cloudConfig.token), gi = prompt("Gist ID:", cloudConfig.gistId); if (gt !== null && gi !== null) { cloudConfig = { token: gt, gistId: gi }; localStorage.setItem('vault_cloud', JSON.stringify(cloudConfig)); await pullFromCloud(); } if (confirm("Refresh IGDB?")) await refreshIGDBToken(); }
        function confirmDelete(el, id) { if (el.innerText === 'DEL') { el.innerText = 'SURE?'; el.classList.add('btn-confirm'); setTimeout(() => { if(el) { el.innerText = 'DEL'; el.classList.remove('btn-confirm'); } }, 3000); } else { items = items.filter(z => z.id !== id); save(); } }
        function autoExpand(el, id) { el.style.height = 'inherit'; el.style.height = el.scrollHeight + 'px'; const i = items.find(x => x.id === id); if (i) { i.notes = el.value; localStorage.setItem('media_v1', JSON.stringify(items)); } }
        function render() { const container = document.getElementById('tables-container'); container.innerHTML = ''; const s = document.getElementById('sort-order').value; const cats = { vidya: 'ðŸŽ® GAMES', movie: 'ðŸŽ¥ CINEMA', tv: 'ðŸ“º SERIES' }, pMap = { 1: 'IMM', 2: 'HI', 3: 'MED', 4: 'LOW' }; Object.entries(cats).forEach(([key, label]) => { let list = items.filter(i => i.category === key); list = showAll ? list.filter(i => i.status === 'done') : list.filter(i => i.status !== 'done'); 
        list.sort((a,b) => { if(s==='priority') return a.priority - b.priority; if(s==='recent') return b.id - a.id; if(s==='rating') return b.score - a.score; if(s==='release') return parseInt(b.release) - parseInt(a.release); if(s==='genre') return a.genre.localeCompare(b.genre); return 0; });
        if (list.length === 0) return; const isCol = collapsed[key]; let section = `<section><div onclick="collapsed['${key}']=!collapsed['${key}']; save();" class="flex items-center gap-2 mb-2 cursor-pointer"><h2 class="text-[10px] font-black tracking-widest">${label} ${isCol ? 'âŠ•' : ''}</h2></div><div style="display:${isCol?'none':'block'}" class="space-y-2">`;
        list.forEach(i => { const nActive = i.notes && i.notes.length > 0; section += `<div class="media-card card-${key} priority-bg-${i.priority} p-3"><div class="category-watermark">${key}</div><div class="flex justify-between items-start relative z-10"><div><h3 class="font-black text-white uppercase text-sm leading-tight">${i.title}</h3><div class="text-[9px] text-white/60 font-bold uppercase tracking-wider">${i.genre} â€¢ ${i.release} â€¢ ${i.runtime}</div></div><div class="flex items-center gap-3"><button onclick="window.open('https://www.youtube.com/results?search_query=${encodeURIComponent(i.title + ' official trailer')}', '_blank')" class="trailer-btn">â–¶</button><span class="font-mono text-lg text-white font-black leading-none">${i.score}</span></div></div><div class="mt-2 flex items-center gap-2 relative z-10"><select onchange="items.find(x=>x.id===${i.id}).priority=parseInt(this.value); save();" class="text-[9px] font-black uppercase px-2 py-1 rounded bg-black/40 text-white border border-white/10 outline-none">${Object.entries(pMap).map(([v, t]) => `<option value="${v}" ${i.priority==v?'selected':''}>${t}</option>`).join('')}</select><span class="notes-trigger" onclick="const ta=document.getElementById('note-${i.id}'); ta.classList.toggle('active'); if(ta.classList.contains('active')) ta.focus();">Notes +</span><select onchange="items.find(x=>x.id===${i.id}).status=this.value; save();" class="text-[9px] font-black uppercase px-2 py-1 rounded bg-black/40 text-white border border-white/10 flex-1 outline-none"><option value="to-do" ${i.status==='to-do'?'selected':''}>To-Do</option><option value="in-progress" ${i.status==='in-progress'?'selected':''}>In Progress</option><option value="done" ${i.status==='done'?'selected':''}>Done</option></select><button onclick="confirmDelete(this, ${i.id})" class="text-white text-[9px] font-black px-2 py-1 bg-red-600/40 rounded border border-white/10 transition-all">DEL</button></div><textarea id="note-${i.id}" class="notes-area relative z-10 ${nActive?'active':''}" placeholder="..." oninput="autoExpand(this, ${i.id})" onblur="save()">${i.notes || ''}</textarea></div>`; }); container.innerHTML += section + `</div></section>`; }); }
        render(); pullFromCloud();
    </script>
</body>
</html>
