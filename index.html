<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="VAULT">
    <meta name="theme-color" content="#020617">
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" href="icon.png">
    
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg:#e6faff;--text:#000;--header:#000;--card-border:rgba(0,0,0,.3);--glass:rgba(15,23,42,.98);--notes-btn:#0369a1;--subtext:#475569}
        body.dark-mode{--bg:#020617;--text:#cbd5e1;--header:#fff;--card-border:rgba(255,255,255,.1);--glass:rgba(0,0,0,.95);--notes-btn:#38bdf8;--subtext:#94a3b8}
        body{background-color:var(--bg)!important;color:var(--text);font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;min-height:100vh;transition:background .3s;padding:1rem}
        .max-w-3xl{max-width:48rem;margin:0 auto}.pb-32{padding-bottom:8rem}.mb-6{margin-bottom:1.5rem}.mb-10{margin-bottom:2.5rem}.mt-6{margin-top:1.5rem}.mt-2{margin-top:.5rem}.mt-12{margin-top:3rem}.mb-2{margin-bottom:.5rem}.ml-4{margin-left:1rem}
        .flex{display:flex}.grid{display:grid}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
        .gap-1{gap:.25rem}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}
        .justify-between{justify-content:space-between}.justify-center{justify-content:center}.items-center{align-items:center}.items-start{align-items:flex-start}.flex-1{flex:1 1 0%}.flex-col{flex-direction:column}
        .space-y-2>*+*{margin-top:.5rem}.space-y-8>*+*{margin-top:2rem}
        .w-full{width:100%}.w-11\/12{width:91.666667%}.w-7{width:1.75rem}.w-8{width:2rem}.w-16{width:4rem}.h-7{height:1.75rem}.h-8{height:2rem}
        .p-2{padding:.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}
        .rounded{border-radius:.25rem}.rounded-xl{border-radius:.75rem}.rounded-2xl{border-radius:1rem}.rounded-3xl{border-radius:1.5rem}.rounded-full{border-radius:9999px}
        .border{border-width:1px}.border-b-4{border-bottom-width:4px}
        .text-xs{font-size:.75rem;line-height:1rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}
        .font-bold{font-weight:700}.font-black{font-weight:900}.uppercase{text-transform:uppercase}.italic{font-style:italic}.leading-none{line-height:1}.leading-tight{line-height:1.25}.text-center{text-align:center}
        .text-white{color:#fff}.bg-black{background-color:#000}.bg-slate-900{background-color:#0f172a}.bg-slate-800{background-color:#1e293b}.bg-blue-600{background-color:#2563eb}.bg-blue-900{background-color:#1e3a8a}.bg-purple-600{background-color:#9333ea}.bg-amber-600{background-color:#d97706}.bg-red-600{background-color:#dc2626}.bg-orange-600{background-color:#ea580c}
        .border-blue-800{border-color:#1e40af}.border-purple-800{border-color:#6b21a8}
        .shadow-lg{box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05)}.shadow-xl{box-shadow:0 20px 25px -5px rgba(0,0,0,.1),0 10px 10px -5px rgba(0,0,0,.04)}.shadow-2xl{box-shadow:0 25px 50px -12px rgba(0,0,0,.25)}
        .cursor-pointer{cursor:pointer}.select-none{user-select:none}.outline-none{outline:0}.hidden{display:none}.relative{position:relative}.absolute{position:absolute}.fixed{position:fixed}.inset-0{top:0;right:0;bottom:0;left:0}.top-0{top:0}.right-0{right:0}.top-10{top:2.5rem}
        .z-10{z-index:10}.z-20{z-index:20}.z-30{z-index:30}.z-40{z-index:40}.z-60{z-index:60}.z-1000{z-index:1000}.z-2000{z-index:2000}.z-3000{z-index:3000}
        .backdrop-blur-md{backdrop-filter:blur(12px)}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
        button:active{transform:scale(.95)}.grayscale{filter:grayscale(100%)}.opacity-20{opacity:.2}.opacity-50{opacity:.5}.opacity-100{opacity:1}.font-mono{font-family:'Courier New',monospace}
        .vault-logo{font-size:2.5rem;font-weight:1000;color:var(--header)!important;font-style:italic;letter-spacing:-.07em;line-height:1;text-transform:uppercase;cursor:pointer;user-select:none}
        .archive-text{color:var(--subtext)!important;font-size:10px;font-weight:1000;text-transform:uppercase;letter-spacing:.25em}
        h2{color:var(--header)!important;font-weight:950!important;text-transform:uppercase;letter-spacing:.15em;font-size:1.1rem!important;margin:0}h3{margin:0}
        .icon-btn{color:var(--header)!important;transition:transform .2s;background:transparent!important}.icon-btn:active{transform:scale(.9)}
        .media-card{position:relative;border:1px solid var(--card-border);backdrop-filter:blur(20px);border-radius:12px;overflow:hidden;margin-bottom:.75rem;box-shadow:0 6px 15px rgba(0,0,0,.25);z-index:10}
        .glass{background:var(--glass);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.1);position:relative;z-index:40}
        .priority-bg-1{background:linear-gradient(135deg,#b91c1c 0%,#0f172a 100%)}.priority-bg-2{background:linear-gradient(135deg,#b45309 0%,#0f172a 100%)}.priority-bg-3{background:linear-gradient(135deg,#1d4ed8 0%,#0f172a 100%)}.priority-bg-4{background:#0f172a}.priority-bg-done{background:#1e293b;opacity:.8}
        .card-vidya{border-left:6px solid #fbbf24}.card-movie{border-left:6px solid #ef4444}.card-tv{border-left:6px solid #10b981}
        .category-watermark{position:absolute;top:-5px;right:40px;font-size:1.8rem;font-weight:950;opacity:.15;pointer-events:none;font-style:italic;text-transform:uppercase;z-index:0;color:#fff}
        #live-results{position:absolute;top:100%;left:0;right:0;background:#020617;border:2px solid #3b82f6;border-top:none;border-radius:0 0 12px 12px;z-index:1000;max-height:350px;overflow-y:auto;display:none;box-shadow:0 20px 40px rgba(0,0,0,.8)}
        #live-results.active{display:block}.live-item{padding:12px;border-bottom:1px solid rgba(255,255,255,.1);cursor:pointer;color:#fff;display:flex;align-items:center;gap:12px}.live-item:hover{background:#1e293b}
        .live-img{width:40px;height:55px;object-fit:cover;border-radius:4px;background:#334155;flex-shrink:0}
        .thin-search{background:0 0;border:none;border-bottom:3px solid var(--header);width:100%;font-size:14px;padding:10px 0;outline:0;color:var(--header);font-weight:950;margin-bottom:1.5rem}
        .thin-search::placeholder{color:var(--header);opacity:.7}
        .notes-trigger{font-size:10px;font-weight:1000;color:var(--notes-btn);letter-spacing:.05em;cursor:pointer;text-transform:uppercase;text-decoration:underline}
        .notes-area{background:rgba(0,0,0,.85);border:1px solid rgba(255,255,255,.4);color:#fff;font-size:12px;width:100%;border-radius:6px;outline:0;resize:none;overflow:hidden;height:0;opacity:0;transition:all .2s}
        .notes-area.active{height:auto;min-height:45px;padding:10px;margin-top:10px;opacity:1}
        #settings-menu{position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:2000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(10px)}#settings-menu.active{display:flex}
        .pri-dot{width:10px;height:10px;border-radius:50%;border:1px solid rgba(255,255,255,.3);cursor:pointer;transition:all .2s;box-shadow:none!important}.pri-dot:hover{transform:scale(1.2)}
        .bg-black\/40{background-color:rgba(0,0,0,.4)}.bg-black\/60{background-color:rgba(0,0,0,.6)}.bg-white\/10{background-color:rgba(255,255,255,.1)}.bg-white\/20{background-color:rgba(255,255,255,.2)}
        .border-white\/5{border-color:rgba(255,255,255,.05)}.border-white\/10{border-color:rgba(255,255,255,.1)}.border-white\/20{border-color:rgba(255,255,255,.2)}.border-white\/40{border-color:rgba(255,255,255,.4)}
        .text-white\/50{color:rgba(255,255,255,.5)}.text-white\/70{color:rgba(255,255,255,.7)}.placeholder-white\/60::placeholder{color:rgba(255,255,255,.6)}
        .text-blue-400{color:#60a5fa}.text-red-400{color:#f87171}.text-\[9px\]{font-size:9px}.text-\[10px\]{font-size:10px}.max-sm{max-width:24rem}.tracking-wider{letter-spacing:.05em}.flex-shrink-0{flex-shrink:0}
        .delete-confirm{background-color:#dc2626!important}
    </style>
</head>
<body id="body-root">
    <div class="max-w-3xl pb-32">
        <header class="mb-6 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div id="sync-icon" onclick="pullFromCloud()" class="icon-btn cursor-pointer">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path><polyline points="22 4 22 10 16 10"></polyline></svg>
                </div>
                <div>
                    <h1 class="vault-logo" onclick="toggleTheme()">VAULT</h1>
                    <p class="archive-text">Archive 2026</p>
                </div>
            </div>
            <button onclick="document.getElementById('settings-menu').classList.toggle('active')" class="icon-btn p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            </button>
        </header>

        <input id="global-search" type="text" class="thin-search" placeholder="FILTER VAULT..." oninput="render()">

        <div class="glass p-5 rounded-3xl mb-10 shadow-2xl">
            <div class="grid grid-cols-1 gap-4">
                <div class="relative z-60">
                    <input id="title" type="text" autocomplete="off" placeholder="Enter Title..." oninput="debounceSearch()" style="background-color:rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.2);padding:1rem;border-radius:0.75rem;color:white;width:100%;outline:none;font-weight:bold" class="placeholder-white\/60">
                    <div id="live-results"></div>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <select id="category" class="bg-slate-900 p-3 rounded-xl text-[10px] text-white font-black uppercase outline-none border border-white/10">
                        <option value="movie">ðŸŽ¥ Movie</option><option value="tv">ðŸ“º TV Show</option><option value="vidya" selected>ðŸŽ® Game</option>
                    </select>
                    <select id="priority" class="bg-slate-900 p-3 rounded-xl text-[10px] text-white font-black uppercase outline-none border border-white/10">
                        <option value="1">Immediate</option><option value="2">High</option><option value="3" selected>Medium</option><option value="4">Low</option>
                    </select>
                    <select id="sort-order" onchange="localStorage.setItem('vault_sort',this.value);render()" class="bg-blue-900 p-3 rounded-xl text-[10px] text-white font-black uppercase outline-none border border-white/10">
                        <option value="priority">Sort: Pri</option><option value="recent">Sort: New</option><option value="rating">Sort: Sc</option><option value="release">Sort: Yr</option><option value="manual">Sort: Man</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button onclick="pickRandom()" class="bg-purple-600 text-white p-3 rounded-xl font-black text-sm uppercase shadow-lg border-b-4 border-purple-800 w-16 flex items-center justify-center">ðŸŽ²</button>
                    <button onclick="finalizeAdd(document.getElementById('title').value,'2026',0,'Custom','--')" class="bg-blue-600 text-white py-3 rounded-xl font-black text-xs uppercase shadow-lg border-b-4 border-blue-800 flex-1">Add</button>
                </div>
            </div>
        </div>
        <div id="tables-container" class="space-y-8"></div>
    </div>

    <div id="settings-menu">
        <div class="bg-slate-900 w-11/12 max-sm p-6 rounded-2xl border border-white/10 shadow-2xl">
            <h3 class="text-white font-black uppercase text-xl mb-6 text-center">Settings</h3>
            <div class="grid grid-cols-2 gap-3 mb-6">
                <button id="archive-toggle-btn" onclick="showArchive=!showArchive;this.innerText=showArchive?'Show Active':'Show Archive';render()" class="bg-amber-600 text-white p-4 rounded-xl text-[10px] font-black uppercase border border-white/5">Show Archive</button>
                <button onclick="toggleTheme()" class="bg-slate-800 text-white p-4 rounded-xl text-[10px] font-black uppercase border border-white/5">Night Mode</button>
                <button onclick="setupCloud()" class="bg-slate-800 text-white p-4 rounded-xl text-[10px] font-black uppercase border border-white/5">Cloud</button>
                <button onclick="downloadBackup()" class="bg-slate-800 text-white p-4 rounded-xl text-[10px] font-black uppercase border border-white/5">Export</button>
                <button onclick="document.getElementById('importFile').click()" class="bg-slate-800 text-white p-4 rounded-xl text-[10px] font-black uppercase border border-white/5">Import</button>
            </div>
            <div id="cat-order-list" class="space-y-2 mb-6"></div>
            <button onclick="document.getElementById('settings-menu').classList.remove('active')" class="w-full bg-white text-black p-4 rounded-xl font-black text-xs uppercase shadow-xl">Close</button>
        </div>
    </div>
    <input type="file" id="importFile" class="hidden" onchange="importBackup(this)">

    <div id="random-modal" onclick="this.style.display='none'" class="fixed inset-0 z-3000 backdrop-blur-md flex flex-col items-center justify-center p-6 cursor-pointer" style="display:none;background:rgba(0,0,0,0.95)">
        <div id="random-content" class="text-center w-full" style="max-width:32rem"></div>
        <div class="mt-12 text-white/50 text-xs font-mono animate-pulse">TAP ANYWHERE TO CLOSE</div>
    </div>

    <script>
        const TMDB_KEY="f8baa5b950fb92e47e7250e9faaa2a5c";
        const RAWG_KEY="40dcecf909e541df8eafbb648d749512";
        let items=JSON.parse(localStorage.getItem('media_v1'))||[],collapsed=JSON.parse(localStorage.getItem('vault_collapsed'))||{},cloudConfig=JSON.parse(localStorage.getItem('vault_cloud'))||{token:'',gistId:''},catOrder=JSON.parse(localStorage.getItem('vault_cat_order'))||['vidya','movie','tv'],searchTimeout,hiddenPriorities=JSON.parse(localStorage.getItem('vault_hidden_pri'))||{vidya:[],movie:[],tv:[]},showArchive=false,deleteTimers={};
        if(localStorage.getItem('vault_dark')==='true')document.body.classList.add('dark-mode');

        function togglePriority(cat,p){const arr=hiddenPriorities[cat];if(arr.includes(p))hiddenPriorities[cat]=arr.filter(x=>x!==p);else arr.push(p);localStorage.setItem('vault_hidden_pri',JSON.stringify(hiddenPriorities));render()}

        function pickRandom(){const pool=items.filter(i=>!hiddenPriorities[i.category]?.includes(i.priority)&&i.status!=='done'&&!collapsed[i.category]);if(pool.length===0){alert("No visible items!");return}const winner=pool[Math.floor(Math.random()*pool.length)];const modal=document.getElementById('random-modal');const content=document.getElementById('random-content');content.innerHTML=`<div class="text-4xl font-black text-white uppercase">${winner.title}</div><div class="text-xl text-blue-400 font-bold mt-2">${winner.genre}</div>`;modal.style.display='flex'}

        async function save(){localStorage.setItem('media_v1',JSON.stringify(items));localStorage.setItem('vault_collapsed',JSON.stringify(collapsed));render();if(cloudConfig.token&&cloudConfig.gistId){try{await fetch(`https://api.github.com/gists/${cloudConfig.gistId}`,{method:"PATCH",headers:{"Authorization":`token ${cloudConfig.token}`},body:JSON.stringify({files:{"vault.json":{content:JSON.stringify(items)}}})})}catch(e){}}}
        async function pullFromCloud(){if(!cloudConfig.token||!cloudConfig.gistId)return;try{const res=await fetch(`https://api.github.com/gists/${cloudConfig.gistId}`,{headers:{"Authorization":`token ${cloudConfig.token}`}});const data=await res.json();if(data.files?.["vault.json"]){items=JSON.parse(data.files["vault.json"].content);render()}}catch(e){}}

        function debounceSearch(){clearTimeout(searchTimeout);searchTimeout=setTimeout(performLiveSearch,400)}

        async function performLiveSearch(){
            const title=document.getElementById('title').value.trim(),cat=document.getElementById('category').value,dropdown=document.getElementById('live-results');
            if(title.length<2){dropdown.classList.remove('active');return}
            dropdown.innerHTML='<div class="p-3 text-xs text-white/50 italic">Searching...</div>';dropdown.classList.add('active');
            try{
                let results=[];
                if(cat==='vidya'){
                    const r=await fetch(`https://api.rawg.io/api/games?key=${RAWG_KEY}&search=${encodeURIComponent(title)}&page_size=20`);
                    const d=await r.json();
                    if(d.results){results=d.results.map(g=>({title:g.name,year:g.released?g.released.split('-')[0]:'TBA',id:g.id,img:g.background_image||'',rating:g.rating||0,genres:g.genres||[]}))}
                }else{
                    const r=await fetch(`https://api.themoviedb.org/3/search/${cat}?api_key=${TMDB_KEY}&query=${encodeURIComponent(title)}`);
                    const d=await r.json();
                    if(d.results)results=d.results.map(m=>({title:m.title||m.name,year:(m.release_date||m.first_air_date||'TBA').split('-')[0],id:m.id,img:m.poster_path?`https://image.tmdb.org/t/p/w92${m.poster_path}`:''}))
                }
                dropdown.innerHTML=`<div onclick="finalizeAdd('${title.replace(/'/g,"\\'")}','2026',0,'Custom','--')" class="live-item text-blue-400 italic text-xs font-black">USE RAW: "${title}"</div>`;
                results.forEach(res=>{const el=document.createElement('div');el.className='live-item';el.innerHTML=`<img src="${res.img||''}" class="live-img"><div><div class="font-bold text-sm">${res.title}</div><div class="text-[10px] opacity-50">${res.year}</div></div>`;el.onclick=()=>processSelection(cat,res.id,res.title,res);dropdown.appendChild(el)})
            }catch(e){console.error('Search error:',e);dropdown.innerHTML=`<div class="p-3 text-xs text-red-400">Network Error</div><div onclick="finalizeAdd('${title.replace(/'/g,"\\'")}','2026',0,'Custom','--')" class="live-item text-blue-400 italic text-xs font-black">USE RAW: "${title}"</div>`}
        }

        async function processSelection(cat,id,title,searchResult){
            document.getElementById('live-results').classList.remove('active');
            try{
                let score=0,year='2026',genre='Genre',runtime='--';
                if(cat==='vidya'){
                    const r=await fetch(`https://api.rawg.io/api/games/${id}?key=${RAWG_KEY}`);
                    const d=await r.json();
                    score=d.rating?Math.round(d.rating*20):0;
                    year=d.released?d.released.split('-')[0]:searchResult.year||'2026';
                    genre=d.genres?.[0]?.name||'Game';
                    runtime='--'
                }else{
                    const det=await(await fetch(`https://api.themoviedb.org/3/${cat}/${id}?api_key=${TMDB_KEY}`)).json();
                    score=Math.round(det.vote_average*10);
                    year=(det.release_date||det.first_air_date||"").split('-')[0];
                    genre=det.genres?.[0]?.name||cat.toUpperCase();
                    if(cat==='movie')runtime=det.runtime?det.runtime+'m':'--';
                    else runtime=(det.number_of_seasons?'S'+det.number_of_seasons:'S1')+' E'+(det.number_of_episodes||'--')
                }
                finalizeAdd(title,year,score,genre,runtime)
            }catch(e){console.error('Process selection error:',e);finalizeAdd(title,'2026',0,cat==='vidya'?'Game':cat.toUpperCase(),'--')}
        }

        function confirmDelete(id){
            const btn=document.getElementById(`del-${id}`);
            if(deleteTimers[id]){
                clearTimeout(deleteTimers[id]);
                delete deleteTimers[id];
                items=items.filter(z=>z.id!==id);
                save()
            }else{
                btn.innerText='SURE?';
                btn.classList.add('delete-confirm');
                deleteTimers[id]=setTimeout(()=>{
                    btn.innerText='DEL';
                    btn.classList.remove('delete-confirm');
                    delete deleteTimers[id]
                },3000)
            }
        }

        function finalizeAdd(title,year,score,genre,runtime){const newItem={id:Date.now(),title,category:document.getElementById('category').value,priority:parseInt(document.getElementById('priority').value),status:'to-do',score,genre,release:year,runtime,notes:''};items.push(newItem);document.getElementById('title').value='';document.getElementById('live-results').classList.remove('active');save()}
        
        function moveCategory(index,dir){if(dir===-1&&index>0){[catOrder[index],catOrder[index-1]]=[catOrder[index-1],catOrder[index]]}if(dir===1&&index<catOrder.length-1){[catOrder[index],catOrder[index+1]]=[catOrder[index+1],catOrder[index]]}localStorage.setItem('vault_cat_order',JSON.stringify(catOrder));renderSettings();render()}
        
        function moveItem(id,dir){const idx=items.findIndex(x=>x.id===id),dest=idx+dir;if(dest>=0&&dest<items.length){[items[idx],items[dest]]=[items[dest],items[idx]];save()}}
        
        function downloadBackup(){const a=document.createElement('a');a.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(items,null,2));a.download="vault_backup.json";a.click()}
        
        function importBackup(i){const r=new FileReader();r.onload=e=>{items=JSON.parse(e.target.result);save()};r.readAsText(i.files[0])}
        
        async function setupCloud(){const gt=prompt("Token:",cloudConfig.token),gi=prompt("Gist ID:",cloudConfig.gistId);if(gt&&gi){cloudConfig={token:gt,gistId:gi};localStorage.setItem('vault_cloud',JSON.stringify(cloudConfig));await pullFromCloud()}}
        
        function autoExpand(el,id){el.style.height='inherit';el.style.height=el.scrollHeight+'px';const i=items.find(x=>x.id===id);if(i){i.notes=el.value;localStorage.setItem('media_v1',JSON.stringify(items))}}
        
        function toggleTheme(){document.body.classList.toggle('dark-mode');localStorage.setItem('vault_dark',document.body.classList.contains('dark-mode'));render()}

        function renderSettings(){const list=document.getElementById('cat-order-list'),labels={vidya:'Games',movie:'Cinema',tv:'Series'};list.innerHTML='';catOrder.forEach((cat,idx)=>{list.innerHTML+=`<div class="flex justify-between items-center bg-black/40 p-3 rounded-xl text-white text-[10px] font-black uppercase"><span>${labels[cat]}</span><div class="flex gap-2"><button onclick="moveCategory(${idx},-1)">â–²</button><button onclick="moveCategory(${idx},1)">â–¼</button></div></div>`})}

        function render(){
            const container=document.getElementById('tables-container'),s=localStorage.getItem('vault_sort')||'priority',filter=document.getElementById('global-search').value.toLowerCase(),cats={vidya:'ðŸŽ® GAMES',movie:'ðŸŽ¥ CINEMA',tv:'ðŸ“º SERIES'},pMap={1:'IMM',2:'HI',3:'MED',4:'LOW'};
            container.innerHTML='';
            catOrder.forEach(key=>{
                let list=items.filter(i=>i.category===key&&i.title.toLowerCase().includes(filter));
                list=showArchive?list.filter(i=>i.status==='done'):list.filter(i=>i.status!=='done'&&!hiddenPriorities[key].includes(i.priority));
                if(s!=='manual')list.sort((a,b)=>{if(s==='priority')return a.priority-b.priority;if(s==='recent')return b.id-a.id;if(s==='rating')return b.score-a.score;if(s==='release')return parseInt(b.release)-parseInt(a.release);return 0});
                
                let pToggles=showArchive?'':'<div class="flex gap-2 ml-4 relative z-30" onclick="event.stopPropagation()">';
                if(!showArchive){[1,2,3,4].forEach(p=>{const colors={1:'bg-red-600',2:'bg-orange-600',3:'bg-blue-600',4:'bg-slate-600'};pToggles+=`<div onclick="togglePriority('${key}',${p})" class="pri-dot ${colors[p]} ${hiddenPriorities[key].includes(p)?'opacity-20 grayscale':'opacity-100'}"></div>`});pToggles+='</div>'}

                if(list.length===0&&!filter)return;
                let section=`<section><div onclick="collapsed['${key}']=!collapsed['${key}'];save()" class="flex items-center mt-6 mb-2 cursor-pointer select-none"><h2>${cats[key]} ${collapsed[key]?'âŠ•':''}</h2>${pToggles}</div><div style="display:${collapsed[key]?'none':'block'}" class="space-y-2">`;
                list.forEach(i=>{
                    const bgClass=i.status==='done'?'priority-bg-done':`priority-bg-${i.priority}`;
                    section+=`<div class="media-card card-${key} ${bgClass} p-3">${s==='manual'&&!showArchive?`<div class="absolute right-0 top-10 flex flex-col gap-1 z-20"><button onclick="moveItem(${i.id},-1)" class="bg-black/60 text-white w-7 h-7 rounded text-[10px]">â–²</button><button onclick="moveItem(${i.id},1)" class="bg-black/60 text-white w-7 h-7 rounded text-[10px]">â–¼</button></div>`:''}<div class="category-watermark">${key}</div><div class="flex justify-between items-start relative z-10"><div><h3 class="font-bold text-white uppercase text-sm leading-tight">${i.title}</h3><div class="text-[9px] text-white/70 uppercase tracking-wider">${i.genre} â€¢ ${i.release} â€¢ ${i.runtime}</div></div><div class="flex items-center gap-3"><button onclick="window.open('https://www.youtube.com/results?search_query=${encodeURIComponent(i.title+' official trailer')}','_blank')" class="bg-white/20 w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold border border-white/40">â–¶</button><span class="font-mono text-lg text-white font-black leading-none">${i.score}</span></div></div><div class="mt-2 flex items-center gap-2 relative z-10"><select onchange="items.find(x=>x.id===${i.id}).priority=parseInt(this.value);save()" class="text-[9px] uppercase px-2 py-1 rounded bg-black/60 text-white border border-white/10 outline-none">${Object.entries(pMap).map(([v,t])=>`<option value="${v}" ${i.priority==v?'selected':''}>${t}</option>`).join('')}</select><span class="notes-trigger" onclick="document.getElementById('note-${i.id}').classList.toggle('active')">Notes +</span><select onchange="items.find(x=>x.id===${i.id}).status=this.value;save()" class="text-[9px] uppercase px-2 py-1 rounded bg-black/60 text-white border border-white/10 flex-1 outline-none"><option value="to-do" ${i.status==='to-do'?'selected':''}>To-Do</option><option value="done" ${i.status==='done'?'selected':''}>Done</option></select><button id="del-${i.id}" onclick="confirmDelete(${i.id})" class="text-white text-[9px] font-black px-2 py-1 bg-white/10 rounded border border-white/10">DEL</button></div><textarea id="note-${i.id}" class="notes-area relative z-10 ${i.notes?'active':''}" placeholder="..." oninput="autoExpand(this,${i.id})" onblur="save()">${i.notes||''}</textarea></div>`
                });
                container.innerHTML+=section+`</div></section>`
            })
        }
        renderSettings();render();pullFromCloud()
    </script>
</body>
</html>
